{% extends 'frontend/base.html' %}
{% load static %}
{% block title %}Book Your Stay - Liok Hotels{% endblock %}

{% block content %}
    <div class="banner-header section-padding valign bg-img bg-fixed" data-overlay-dark="3" data-background="{% static 'img/slider/1.jpg' %}">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-left caption mt-90">
                    <h5>Reservations</h5>
                    <h1>Book Your Stay</h1>
                </div>
            </div>
        </div>
    </div>

    <section class="contact section-padding">
        <div class="container">
            <div class="row mb-90">
                <div class="col-md-6 mb-60">
                    <h3>Inquiry Details</h3>
                    <p>
                        Please provide your travel details below. Our team at Liok Hotels will review 
                        your inquiry and get back to you to confirm your stay.
                    </p>

                    <div class="reservations mb-30">
                        <div class="icon"><span class="flaticon-call"></span></div>
                        <div class="text">
                            <p>Reservation Support</p>
                            <a href="tel:+918987678765">+91 89876 78765</a>
                        </div>
                    </div>

                    <div class="reservations">
                        <div class="icon"><span class="flaticon-envelope"></span></div>
                        <div class="text">
                            <p>Email Inquiry</p>
                            <a href="mailto:booking@liokhotels.com">booking@liokhotels.com</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-5 mb-30 offset-md-1">
                    <h3>Booking Form</h3>
                    <form method="post" action="{% url 'admin_pages:book_now' %}" class="contact__form">
                        {% csrf_token %}

                        {% if messages %}
                            <div class="row">
                                {% for message in messages %}
                                    <div class="alert alert-success contact__msg" role="alert">
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}

                        <div class="row">
                            <div class="col-md-6 form-group mb-3">
                                <input name="first_name" type="text" class="form-control" placeholder="First Name *" required>
                            </div>
                            <div class="col-md-6 form-group mb-3">
                                <input name="last_name" type="text" class="form-control" placeholder="Last Name *" required>
                            </div>
                            <div class="col-md-6 form-group mb-3">
                                <input name="phone" type="text" class="form-control" placeholder="Phone Number *" required>
                            </div>
                            <div class="col-md-6 form-group mb-3">
                                <input name="email" type="email" class="form-control" placeholder="Email Address">
                            </div>

                            <div class="col-md-12 form-group mb-3">
                                <select name="property" id="propertySelect" class="form-control" required style="background: transparent; color: #666;">
                                    <option value="" disabled selected>Select Property *</option>
                                    {% for prop in properties %}
                                        <option value="{{ prop.id }}">{{ prop.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="col-md-12 form-group mb-3">
                                <select name="room_category" id="roomSelect" class="form-control" required style="background: transparent; color: #666;">
                                    <option value="" disabled selected>Select Room Category *</option>
                                </select>
                            </div>

                            <div class="col-md-6 form-group mb-3">
                                <label style="font-size: 12px; color: #aa8453;">Check-In *</label>
                                <input name="check_in" type="date" class="form-control" required>
                            </div>
                            <div class="col-md-6 form-group mb-3">
                                <label style="font-size: 12px; color: #aa8453;">Check-Out *</label>
                                <input name="check_out" type="date" class="form-control" required>
                            </div>
                            <div class="col-md-12 form-group mb-3">
                                <input name="guests" type="number" class="form-control" placeholder="Number of Guests" min="1" value="2">
                            </div>

                            <div class="col-md-12 form-group mb-3">
                                <textarea name="message" rows="3" class="form-control" placeholder="Special Requests or Message"></textarea>
                            </div>

                            <div class="col-md-12">
                                <button type="submit" class="butn-dark2 w-100">
                                    <span>Submit Inquiry</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
    </section>
    <!-- Map Section -->
            <div class="row">
                <div class="col-md-12 map animate-box" data-animate-effect="fadeInUp">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1573147.7480448114!2d-74.84628175962355!3d41.04009641088412!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c25856139b3d33%3A0xb2739f33610a08ee!2s1616%20Broadway%2C%20New%20York%2C%20NY%2010019%2C%20Amerika%20Birle%C5%9Fik%20Devletleri!5e0!3m2!1str!2str!4v1646760525018!5m2!1str!2str" width="100%" height="600" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>

<script id="room-data" type="application/json">
    {
        {% for prop in properties %}
            "{{ prop.id }}": [
                {% for room in prop.rooms.all %}
                    {"name": "{{ room.name }}", "price": "{{ room.price_per_night }}"}{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]{% if not forloop.last %},{% endif %}
        {% endfor %}
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const propertySelect = document.getElementById('propertySelect');
        const roomSelect = document.getElementById('roomSelect');
        const roomData = JSON.parse(document.getElementById('room-data').textContent);

        // Update rooms based on selected property
        propertySelect.addEventListener('change', function() {
            const propertyId = this.value;
            const rooms = roomData[propertyId] || [];
            
            // Clear existing options
            roomSelect.innerHTML = '<option value="" disabled selected>Select Room Category *</option>';
            
            // Add new options
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.name;
                option.textContent = `${room.name} (â‚¹${room.price})`;
                roomSelect.appendChild(option);
            });
        });

        // Date Validation
        const today = new Date().toISOString().split('T')[0];
        document.getElementsByName("check_in")[0].setAttribute('min', today);
        document.getElementsByName("check_out")[0].setAttribute('min', today);
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.contact__form');
        const submitBtn = form.querySelector('button[type="submit"]');
        
        // Ensure button submits the form
        submitBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (form.checkValidity()) {
                form.submit();
            } else {
                form.reportValidity();
            }
        });
    });
    </script>
{% endblock %}